<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kelime Oyunu - Final V6 (Oto Focus)</title>
    <style>
        :root {
            --hex-bg: #dfe6e9;
            --hex-active: #f1c40f;
            --hex-user: #ffffff;
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --wrong-color: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* GİZLİ INPUT */
        #hidden-input {
            position: absolute;
            opacity: 0; 
            top: -1000px;
            left: -1000px;
            height: 0;
            width: 0;
            font-size: 16px; 
            pointer-events: none;
        }

        #stats-bar {
            width: 90%;
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: bold;
        }

        #question-area {
            text-align: center;
            margin-bottom: 20px;
            padding: 0 15px;
            min-height: 80px;
        }

        #question-text { font-size: 1.3rem; margin-bottom: 5px; line-height: 1.4; }
        #extra-hint-text { color: #3498db; font-style: italic; min-height: 20px; font-size: 0.9rem; }

        #word-container {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            cursor: text;
            padding: 10px;
        }

        .letter-slot {
            width: 45px;
            height: 50px;
            background-color: var(--hex-bg);
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            transition: all 0.2s;
            position: relative;
        }

        @media (min-width: 600px) {
            .letter-slot { width: 55px; height: 60px; font-size: 1.8rem; gap: 8px; }
            #question-text { font-size: 1.6rem; }
        }

        .letter-slot.revealed { background-color: var(--hex-active); color: #2c3e50; }
        .letter-slot.user-input { background-color: var(--hex-user); border: 2px solid #fff; color: #000; }
        
        .letter-slot.current-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: #333;
            font-weight: 100;
            position: absolute;
        }
        .letter-slot.user-input.current-cursor::after { display: none; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        #controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
            padding-bottom: 20px;
        }

        button {
            padding: 12px 20px;
            font-size: 0.9rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: opacity 0.2s;
        }
        button:active { transform: translateY(2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        #btn-get-letter { background-color: #7f8c8d; color: white; }
        #btn-hint { background-color: #8e44ad; color: white; }
        #btn-submit { background-color: #27ae60; color: white; display: none; }

        #message-area {
            height: 40px;
            margin-top: 10px;
            font-size: 1rem;
            font-weight: bold;
            text-align: center;
            padding: 0 10px;
        }
        
        .blink-red { animation: blink-text 1s infinite; color: var(--wrong-color); }
        @keyframes blink-text { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <input type="text" id="hidden-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

    <div id="stats-bar">
        <div>Puan: <span id="score" style="color:#f1c40f">0</span></div>
        <div>Süre: <span id="timer" style="color:#f1c40f">05:00</span></div>
    </div>

    <div id="question-area">
        <div id="question-text">Soru Yükleniyor...</div>
        <div id="extra-hint-text"></div>
    </div>

    <div id="word-container" onclick="focusInput()"></div>

    <div id="message-area"></div>

    <div id="controls">
        <button id="btn-get-letter" onclick="getLetter()">Harf Al (-100)</button>
        <button id="btn-hint" onclick="useHint()">Ekstra İpucu (<span id="hint-count">2</span>)</button>
        <button id="btn-submit" onclick="submitGuess()">ONAYLA</button>
    </div>

<script>
    // --- OYUN VERİSİ ---
    const questions = [
        { word: "KEDİ", question: "Evcil, nankör olduğu söylenen hayvan.", hint: "Miyavlar." },
        { word: "SEHPA", question: "Üzerine çay, kahve konulan küçük masa.", hint: "Mobilya." },
        { word: "KARTAL", question: "Yırtıcı bir kuş türü, Beşiktaş'ın simgesi.", hint: "Yüksekten uçar." },
        { word: "TELEFON", question: "Uzaktaki kişilerle konuşmayı sağlayan cihaz.", hint: "Alo denir." },
        { word: "BİLGİSAYAR", question: "Veri işleyen elektronik cihaz.", hint: "Klavyesi var." },
        { word: "HELİKOPTER", question: "Pervaneli hava taşıtı.", hint: "Dikey iniş yapar." },
        { word: "CUMHURİYET", question: "Halkın kendi kendini yönettiği yönetim şekli.", hint: "29 Ekim." }
    ];

    let currentQIndex = 0;
    let totalScore = 0;
    let currentWordValue = 0;
    let timeLeft = 300;
    let hintsLeft = 2;
    
    let revealedIndices = []; 
    let userInputs = [];      
    let wrongGuessCount = 0;  
    
    let hintUsedThisRound = false; 
    
    let timerInterval;
    let isGameActive = false;
    let isWaitingNext = false;

    // DOM
    const uiScore = document.getElementById('score');
    const uiTimer = document.getElementById('timer');
    const uiQuestion = document.getElementById('question-text');
    const uiExtraHint = document.getElementById('extra-hint-text');
    const uiWordContainer = document.getElementById('word-container');
    const uiMessage = document.getElementById('message-area');
    const uiHintCount = document.getElementById('hint-count');
    const btnGetLetter = document.getElementById('btn-get-letter');
    const btnSubmit = document.getElementById('btn-submit');
    const btnHint = document.getElementById('btn-hint');
    const hiddenInput = document.getElementById('hidden-input');

    function initGame() {
        isGameActive = true;
        uiTimer.innerText = formatTime(timeLeft);
        startTimer();
        loadQuestion();
        setupMobileInput();
    }

    function formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            if (timeLeft > 0 && isGameActive) {
                timeLeft--;
                uiTimer.innerText = formatTime(timeLeft);
            } else if (timeLeft <= 0) {
                uiTimer.innerText = "00:00";
                endGame("Süre Doldu!");
            }
        }, 1000);
    }

    function setupMobileInput() {
        hiddenInput.value = " ";
        hiddenInput.addEventListener('input', (e) => {
            if (!isGameActive || isWaitingNext) {
                hiddenInput.value = " "; 
                return;
            }
            const val = hiddenInput.value;
            if (val.length === 0) {
                deleteLastInput();
                hiddenInput.value = " "; 
                return;
            }
            if (val.length > 1) {
                const char = val.slice(-1).toUpperCase();
                const trMap = { 'i': 'İ', 'ı': 'I', 'ğ': 'Ğ', 'ü': 'Ü', 'ş': 'Ş', 'ö': 'Ö', 'ç': 'Ç' };
                const finalChar = trMap[char.toLowerCase()] || char;
                if (/^[A-ZİIĞÜŞÖÇ]$/.test(finalChar)) {
                    fillNextSlot(finalChar);
                }
                hiddenInput.value = " ";
            }
        });
        hiddenInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                submitGuess();
            }
        });
    }

    function focusInput() {
        if (!isGameActive || isWaitingNext) return;
        hiddenInput.focus();
        if(window.innerWidth < 600) {
            btnSubmit.style.display = "inline-block";
        }
    }

    function loadQuestion() {
        if (currentQIndex >= questions.length) {
            endGame("Tebrikler! Oyun Bitti. Toplam Puan: " + totalScore);
            return;
        }

        const q = questions[currentQIndex];
        revealedIndices = [];
        userInputs = new Array(q.word.length).fill(null);
        wrongGuessCount = 0;
        currentWordValue = q.word.length * 100;
        isWaitingNext = false;
        
        hintUsedThisRound = false; 
        
        uiQuestion.innerText = q.question;
        uiExtraHint.innerText = "";
        uiMessage.innerText = "";
        uiMessage.className = "";
        
        btnGetLetter.disabled = false;
        btnSubmit.style.display = "none";
        
        if (hintsLeft > 0) {
            btnHint.disabled = false;
        } else {
            btnHint.disabled = true;
        }

        hiddenInput.value = " ";
        renderGrid();
        
        // --- KRİTİK EKLEME: PC için zorla odakla, Mobil için şansını dene ---
        setTimeout(() => {
            hiddenInput.focus();
        }, 100);
    }

    function renderGrid() {
        uiWordContainer.innerHTML = "";
        const word = questions[currentQIndex].word;
        let cursorIndex = getFirstEmptyIndex();

        for (let i = 0; i < word.length; i++) {
            const slot = document.createElement('div');
            slot.classList.add('letter-slot');
            
            if (!isWaitingNext && i === cursorIndex) {
                slot.classList.add('current-cursor');
            }

            if (revealedIndices.includes(i)) {
                slot.classList.add('revealed');
                slot.innerText = word[i];
            } else if (userInputs[i] !== null) {
                slot.classList.add('user-input');
                slot.innerText = userInputs[i];
            } else {
                slot.innerText = "";
            }
            uiWordContainer.appendChild(slot);
        }
    }

    function getFirstEmptyIndex() {
        const wordLength = questions[currentQIndex].word.length;
        for (let i = 0; i < wordLength; i++) {
            if (!revealedIndices.includes(i) && userInputs[i] === null) return i;
        }
        return -1;
    }

    function fillNextSlot(char) {
        const targetIndex = getFirstEmptyIndex();
        if (targetIndex !== -1) {
            userInputs[targetIndex] = char;
            renderGrid();
        }
    }

    function deleteLastInput() {
        const wordLength = questions[currentQIndex].word.length;
        for (let i = wordLength - 1; i >= 0; i--) {
            if (!revealedIndices.includes(i) && userInputs[i] !== null) {
                userInputs[i] = null;
                renderGrid();
                return;
            }
        }
    }

    function getLetter() {
        if (!isGameActive || isWaitingNext) return;
        
        // Odak kaybetme!
        hiddenInput.focus(); 

        const word = questions[currentQIndex].word;
        let unrevealedSystem = [];
        for(let i=0; i<word.length; i++) {
            if(!revealedIndices.includes(i)) unrevealedSystem.push(i);
        }

        if (unrevealedSystem.length === 0) return;

        const randomIndex = unrevealedSystem[Math.floor(Math.random() * unrevealedSystem.length)];
        
        userInputs[randomIndex] = null; 
        revealedIndices.push(randomIndex);
        currentWordValue -= 100;
        
        renderGrid();

        if (revealedIndices.length === word.length) {
            totalScore -= (word.length * 100);
            uiScore.innerText = totalScore;
            uiMessage.style.color = "#e74c3c";
            uiMessage.innerText = "Tüm harfler açıldı, puan silindi!";
            isWaitingNext = true;
            // Blur etmiyoruz! Focus'u koruyoruz.
            setTimeout(nextQuestion, 2000);
        }
    }

    function useHint() {
        if (hintUsedThisRound) {
            uiMessage.innerText = "Bu soru için ipucu zaten aldınız.";
            return;
        }

        if (hintsLeft > 0) {
            hintsLeft--;
            hintUsedThisRound = true; 
            
            uiHintCount.innerText = hintsLeft;
            uiExtraHint.innerText = "İPUCU: " + questions[currentQIndex].hint;
            
            btnHint.disabled = true;
            hiddenInput.focus();
        } else {
            uiMessage.innerText = "İpucu hakkınız kalmadı!";
        }
    }

    function submitGuess() {
        if(!isGameActive || isWaitingNext) return;
        const word = questions[currentQIndex].word;
        let builtWord = "";
        let isComplete = true;

        for (let i = 0; i < word.length; i++) {
            if (revealedIndices.includes(i)) builtWord += word[i];
            else if (userInputs[i] !== null) builtWord += userInputs[i];
            else isComplete = false;
        }

        if (!isComplete) {
            uiMessage.style.color = "#f39c12";
            uiMessage.innerText = "Lütfen tüm kutucukları doldurun.";
            hiddenInput.focus();
            setTimeout(() => uiMessage.innerText = "", 1500);
            return;
        }

        if (builtWord === word) {
            totalScore += currentWordValue;
            uiScore.innerText = totalScore;
            uiMessage.className = "";
            uiMessage.style.color = "#2ecc71";
            uiMessage.innerText = "DOĞRU CEVAP!";
            revealedIndices = Array.from({length: word.length}, (_, i) => i);
            userInputs.fill(null);
            renderGrid();
            
            // --- KRİTİK DEĞİŞİKLİK: BLUR KALDIRILDI ---
            // hiddenInput.blur(); <-- BU SATIR SİLİNDİ
            // Yerine:
            hiddenInput.focus(); // Focus'u yenile
            
            isWaitingNext = true;
            setTimeout(nextQuestion, 1500);
        } else {
            wrongGuessCount++;
            if (wrongGuessCount === 1) {
                uiMessage.className = "blink-red";
                uiMessage.innerText = "YANLIŞ! 1 deneme hakkınız daha var.";
                userInputs.fill(null);
                renderGrid();
                hiddenInput.focus();
            } else {
                uiMessage.className = "";
                uiMessage.style.color = "#e74c3c";
                uiMessage.innerText = "BİLEMEDİNİZ! Doğru cevap: " + word;
                revealedIndices = Array.from({length: word.length}, (_, i) => i);
                userInputs.fill(null);
                renderGrid();
                // Burada da blur yok, akış devam ediyor
                isWaitingNext = true;
                setTimeout(nextQuestion, 3000);
            }
        }
    }

    function nextQuestion() {
        currentQIndex++;
        loadQuestion();
    }

    function endGame(msg) {
        isGameActive = false;
        clearInterval(timerInterval);
        uiQuestion.innerText = msg;
        uiWordContainer.innerHTML = "";
        document.getElementById('controls').style.display = "none";
        uiMessage.innerText = "";
        hiddenInput.blur(); // Oyun bitince klavyeyi kapat
    }

    window.onload = initGame;

</script>
</body>
</html>
